define(["./AttributeCompression-90851096","./Cartographic-3309dd0d","./Color-5008547b","./when-b60132fc","./Cartesian2-47311507","./IndexDatatype-8a5eead4","./Math-119be1a3","./OrientedBoundingBox-bfa2f286","./createTaskProcessorWorker","./Check-7b2a090c","./FeatureDetection-c3b71206","./WebGLConstants-4ae0db90","./PrimitiveType-108f83af","./Cartesian4-3ca25aab","./RuntimeError-4a5c8994","./EllipsoidTangentPlane-806cff3c","./IntersectionTests-6eb562ca","./Plane-e2d409ef","./GeometryAttribute-b20c1286","./buildModuleUrl-3addfe33","./PolygonPipeline-03d66105","./earcut-2.2.1-20c8012f","./ComponentDatatype-c140a87d","./EllipsoidRhumbLine-ed1a6bf4"],(function(e,a,r,n,t,i,o,s,f,d,c,u,l,h,p,g,b,y,C,m,v,I,w,x){"use strict";var A=new a.Cartesian3,E=new t.Ellipsoid,N=new t.Rectangle,T={min:void 0,max:void 0,indexBytesPerElement:void 0};function k(e,a,n){var t=a.length,i=2+t*s.OrientedBoundingBox.packedLength+1+function(e){for(var a=e.length,n=0,t=0;t<a;++t)n+=r.Color.packedLength+3+e[t].batchIds.length;return n}(n),o=new Float64Array(i),f=0;o[f++]=e,o[f++]=t;for(var d=0;d<t;++d)s.OrientedBoundingBox.pack(a[d],o,f),f+=s.OrientedBoundingBox.packedLength;var c=n.length;o[f++]=c;for(var u=0;u<c;++u){var l=n[u];r.Color.pack(l.color,o,f),f+=r.Color.packedLength,o[f++]=l.offset,o[f++]=l.count;var h=l.batchIds,p=h.length;o[f++]=p;for(var g=0;g<p;++g)o[f++]=h[g]}return o}var B=new a.Cartesian3,L=new a.Cartesian3,O=new a.Cartesian3,P=new a.Cartesian3,U=new a.Cartesian3,F=new a.Cartographic,D=new t.Rectangle;return f((function(f,d){var c;!function(e){var r=new Float64Array(e),n=0;T.indexBytesPerElement=r[n++],T.min=r[n++],T.max=r[n++],a.Cartesian3.unpack(r,n,A),n+=a.Cartesian3.packedLength,t.Ellipsoid.unpack(r,n,E),n+=t.Ellipsoid.packedLength,t.Rectangle.unpack(r,n,N)}(f.packedBuffer),c=2===T.indexBytesPerElement?new Uint16Array(f.indices):new Uint32Array(f.indices);var u,l,h,p=new Uint16Array(f.positions),g=new Uint32Array(f.counts),b=new Uint32Array(f.indexCounts),y=new Uint32Array(f.batchIds),C=new Uint32Array(f.batchTableColors),m=new Array(g.length),v=A,I=E,w=N,x=T.min,R=T.max,S=f.minimumHeights,M=f.maximumHeights;n.defined(S)&&n.defined(M)&&(S=new Float32Array(S),M=new Float32Array(M));var _=p.length/2,G=p.subarray(0,_),Y=p.subarray(_,2*_);e.AttributeCompression.zigZagDeltaDecode(G,Y);var V=new Float32Array(3*_);for(u=0;u<_;++u){var H=G[u],W=Y[u],z=o.CesiumMath.lerp(w.west,w.east,H/32767),Z=o.CesiumMath.lerp(w.south,w.north,W/32767),j=a.Cartographic.fromRadians(z,Z,0,F),q=I.cartographicToCartesian(j,B);a.Cartesian3.pack(q,V,3*u)}var J=g.length,K=new Array(J),Q=new Array(J),X=0,$=0;for(u=0;u<J;++u)K[u]=X,Q[u]=$,X+=g[u],$+=b[u];var ee,ae=new Float32Array(3*_*2),re=new Uint16Array(2*_),ne=new Uint32Array(Q.length),te=new Uint32Array(b.length),ie=[],oe={};for(u=0;u<J;++u)h=C[u],n.defined(oe[h])?(oe[h].positionLength+=g[u],oe[h].indexLength+=b[u],oe[h].batchIds.push(u)):oe[h]={positionLength:g[u],indexLength:b[u],offset:0,indexOffset:0,batchIds:[u]};var se=0,fe=0;for(h in oe)if(oe.hasOwnProperty(h)){(ee=oe[h]).offset=se,ee.indexOffset=fe;var de=2*ee.positionLength,ce=2*ee.indexLength+6*ee.positionLength;se+=de,fe+=ce,ee.indexLength=ce}var ue=[];for(h in oe)oe.hasOwnProperty(h)&&(ee=oe[h],ue.push({color:r.Color.fromRgba(parseInt(h)),offset:ee.indexOffset,count:ee.indexLength,batchIds:ee.batchIds}));for(u=0;u<J;++u){var le=(ee=oe[h=C[u]]).offset,he=3*le,pe=le,ge=K[u],be=g[u],ye=y[u],Ce=x,me=R;n.defined(S)&&n.defined(M)&&(Ce=S[u],me=M[u]);var ve=Number.POSITIVE_INFINITY,Ie=Number.NEGATIVE_INFINITY,we=Number.POSITIVE_INFINITY,xe=Number.NEGATIVE_INFINITY;for(l=0;l<be;++l){var Ae=a.Cartesian3.unpack(V,3*ge+3*l,B);I.scaleToGeodeticSurface(Ae,Ae);var Ee=I.cartesianToCartographic(Ae,F),Ne=Ee.latitude,Te=Ee.longitude;ve=Math.min(Ne,ve),Ie=Math.max(Ne,Ie),we=Math.min(Te,we),xe=Math.max(Te,xe);var ke=I.geodeticSurfaceNormal(Ae,L),Be=a.Cartesian3.multiplyByScalar(ke,Ce,O),Le=a.Cartesian3.add(Ae,Be,P);Be=a.Cartesian3.multiplyByScalar(ke,me,Be);var Oe=a.Cartesian3.add(Ae,Be,U);a.Cartesian3.subtract(Oe,v,Oe),a.Cartesian3.subtract(Le,v,Le),a.Cartesian3.pack(Oe,ae,he),a.Cartesian3.pack(Le,ae,he+3),re[pe]=ye,re[pe+1]=ye,he+=6,pe+=2}(w=D).west=we,w.east=xe,w.south=ve,w.north=Ie,m[u]=s.OrientedBoundingBox.fromRectangle(w,x,R,I);var Pe=ee.indexOffset,Ue=Q[u],Fe=b[u];for(ne[u]=Pe,l=0;l<Fe;l+=3){var De=c[Ue+l]-ge,Re=c[Ue+l+1]-ge,Se=c[Ue+l+2]-ge;ie[Pe++]=2*De+le,ie[Pe++]=2*Re+le,ie[Pe++]=2*Se+le,ie[Pe++]=2*Se+1+le,ie[Pe++]=2*Re+1+le,ie[Pe++]=2*De+1+le}for(l=0;l<be;++l){var Me=l,_e=(l+1)%be;ie[Pe++]=2*Me+1+le,ie[Pe++]=2*_e+le,ie[Pe++]=2*Me+le,ie[Pe++]=2*Me+1+le,ie[Pe++]=2*_e+1+le,ie[Pe++]=2*_e+le}ee.offset+=2*be,ee.indexOffset=Pe,te[u]=Pe-ne[u]}ie=i.IndexDatatype.createTypedArray(ae.length/3,ie);for(var Ge=ue.length,Ye=0;Ye<Ge;++Ye){for(var Ve=ue[Ye].batchIds,He=0,We=Ve.length,ze=0;ze<We;++ze)He+=te[Ve[ze]];ue[Ye].count=He}var Ze=k(2===ie.BYTES_PER_ELEMENT?i.IndexDatatype.UNSIGNED_SHORT:i.IndexDatatype.UNSIGNED_INT,m,ue);return d.push(ae.buffer,ie.buffer,ne.buffer,te.buffer,re.buffer,Ze.buffer),{positions:ae.buffer,indices:ie.buffer,indexOffsets:ne.buffer,indexCounts:te.buffer,batchIds:re.buffer,packedBuffer:Ze.buffer}}))}));
