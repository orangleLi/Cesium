define(["exports","./PrimitiveType-108f83af","./Cartesian2-47311507","./Cartographic-3309dd0d","./Cartesian4-3ca25aab","./Check-7b2a090c","./when-b60132fc","./EllipsoidTangentPlane-806cff3c","./Math-119be1a3","./Plane-e2d409ef","./PolygonPipeline-03d66105"],(function(a,t,e,n,r,i,s,o,C,u,d){"use strict";var c=[];function h(a,e){this.center=n.Cartesian3.clone(s.defaultValue(a,n.Cartesian3.ZERO)),this.halfAxes=t.Matrix3.clone(s.defaultValue(e,t.Matrix3.ZERO)),this.areaDirty=1}c[0]={num:0,des:"inside"},c[1]={num:4,data:[0,4,7,3],des:"left"},c[2]={num:4,data:[1,2,6,5],des:"right"},c[3]={num:0},c[4]={num:4,data:[0,1,5,4],des:"bottom"},c[5]={num:6,data:[0,1,5,4,7,3],des:"bottom, left"},c[6]={num:6,data:[0,1,2,6,5,4],des:"bottom, right"},c[7]={num:0},c[8]={num:4,data:[2,3,7,6],des:"top"},c[9]={num:6,data:[4,7,6,2,3,0],des:"top, left"},c[10]={num:6,data:[2,3,7,6,5,1],des:"top, right"},c[11]={num:0},c[12]={num:0},c[13]={num:0},c[14]={num:0},c[15]={num:0},c[16]={num:4,data:[0,3,2,1],des:"front"},c[17]={num:6,data:[0,4,7,3,2,1],des:"front, left"},c[18]={num:6,data:[0,3,2,6,5,1],des:"front, right"},c[19]={num:0},c[20]={num:6,data:[0,3,2,1,5,4],des:"front, bottom"},c[21]={num:6,data:[2,1,5,4,7,3],des:"front, bottom, left"},c[22]={num:6,data:[0,3,2,6,5,4],des:"front, bottom, right"},c[23]={num:0},c[24]={num:6,data:[0,3,7,6,2,1],des:"front, top"},c[25]={num:6,data:[0,4,7,6,2,1],des:"front, top, left"},c[26]={num:6,data:[0,3,7,6,5,1],des:"front, top, right"},c[27]={num:0},c[28]={num:0},c[29]={num:0},c[30]={num:0},c[31]={num:0},c[32]={num:4,data:[4,5,6,7],des:"back"},c[33]={num:6,data:[4,5,6,7,3,0],des:"back, left"},c[34]={num:6,data:[1,2,6,7,4,5],des:"back, right"},c[35]={num:0},c[36]={num:6,data:[0,1,5,6,7,4],des:"back, bottom"},c[37]={num:6,data:[0,1,5,6,7,3],des:"back, bottom, left"},c[38]={num:6,data:[0,1,2,6,7,4],des:"back, bottom, right"},c[39]={num:0},c[40]={num:6,data:[2,3,7,4,5,6],des:"back, top"},c[41]={num:6,data:[0,4,5,6,2,3],des:"back, top, left"},c[42]={num:6,data:[1,2,3,7,4,5],des:"back, top, right"},h.packedLength=n.Cartesian3.packedLength+t.Matrix3.packedLength,h.pack=function(a,e,r){return r=s.defaultValue(r,0),n.Cartesian3.pack(a.center,e,r),t.Matrix3.pack(a.halfAxes,e,r+n.Cartesian3.packedLength),e},h.unpack=function(a,e,r){return e=s.defaultValue(e,0),s.defined(r)||(r=new h),n.Cartesian3.unpack(a,e,r.center),t.Matrix3.unpack(a,e+n.Cartesian3.packedLength,r.halfAxes),r};var l=new n.Cartesian3,m=new n.Cartesian3,x=new n.Cartesian3,p=new n.Cartesian3,f=new n.Cartesian3,M=new n.Cartesian3,g=new t.Matrix3,w={unitary:new t.Matrix3,diagonal:new t.Matrix3},b=new n.Cartesian3,y=new n.Cartesian3,v=new n.Cartesian3;h.fromPoints=function(a,e){if(s.defined(e)||(e=new h),!s.defined(a)||0===a.length)return e.halfAxes=t.Matrix3.ZERO,e.center=n.Cartesian3.ZERO,e;var r,i=a.length,o=n.Cartesian3.clone(a[0],l);for(r=1;r<i;r++)n.Cartesian3.add(o,a[r],o);var C=1/i;n.Cartesian3.multiplyByScalar(o,C,o);var u,d=0,c=0,b=0,y=0,v=0,P=0;for(r=0;r<i;r++)d+=(u=n.Cartesian3.subtract(a[r],o,m)).x*u.x,c+=u.x*u.y,b+=u.x*u.z,y+=u.y*u.y,v+=u.y*u.z,P+=u.z*u.z;d*=C,c*=C,b*=C,y*=C,v*=C,P*=C;var O=g;O[0]=d,O[1]=c,O[2]=b,O[3]=c,O[4]=y,O[5]=v,O[6]=b,O[7]=v,O[8]=P;var z=t.Matrix3.computeEigenDecomposition(O,w),A=t.Matrix3.clone(z.unitary,e.halfAxes),N=t.Matrix3.getColumn(A,0,p),T=t.Matrix3.getColumn(A,1,f),R=t.Matrix3.getColumn(A,2,M),I=-Number.MAX_VALUE,E=-Number.MAX_VALUE,B=-Number.MAX_VALUE,L=Number.MAX_VALUE,k=Number.MAX_VALUE,V=Number.MAX_VALUE;for(r=0;r<i;r++)u=a[r],I=Math.max(n.Cartesian3.dot(N,u),I),E=Math.max(n.Cartesian3.dot(T,u),E),B=Math.max(n.Cartesian3.dot(R,u),B),L=Math.min(n.Cartesian3.dot(N,u),L),k=Math.min(n.Cartesian3.dot(T,u),k),V=Math.min(n.Cartesian3.dot(R,u),V);N=n.Cartesian3.multiplyByScalar(N,.5*(L+I),N),T=n.Cartesian3.multiplyByScalar(T,.5*(k+E),T),R=n.Cartesian3.multiplyByScalar(R,.5*(V+B),R);var S=n.Cartesian3.add(N,T,e.center);n.Cartesian3.add(S,R,S);var U=x;return U.x=I-L,U.y=E-k,U.z=B-V,n.Cartesian3.multiplyByScalar(U,.5,U),t.Matrix3.multiplyByScale(e.halfAxes,U,e.halfAxes),e};var P=new n.Cartesian3,O=new n.Cartesian3;function z(a,e,r,i,o,C,u,d,c,l,m){s.defined(m)||(m=new h);var x=m.halfAxes;t.Matrix3.setColumn(x,0,e,x),t.Matrix3.setColumn(x,1,r,x),t.Matrix3.setColumn(x,2,i,x);var p=P;p.x=(o+C)/2,p.y=(u+d)/2,p.z=(c+l)/2;var f=O;f.x=(C-o)/2,f.y=(d-u)/2,f.z=(l-c)/2;var M=m.center;return p=t.Matrix3.multiplyByVector(x,p,p),n.Cartesian3.add(a,p,M),t.Matrix3.multiplyByScale(x,f,x),m}var A=new n.Cartographic,N=new n.Cartesian3,T=new n.Cartographic,R=new n.Cartographic,I=new n.Cartographic,E=new n.Cartographic,B=new n.Cartographic,L=new n.Cartesian3,k=new n.Cartesian3,V=new n.Cartesian3,S=new n.Cartesian3,U=new n.Cartesian3,_=new e.Cartesian2,D=new e.Cartesian2,X=new e.Cartesian2,W=new e.Cartesian2,q=new e.Cartesian2,j=new n.Cartesian3,Z=new n.Cartesian3,F=new n.Cartesian3,G=new n.Cartesian3,Y=new e.Cartesian2,H=new n.Cartesian3,J=new n.Cartesian3,K=new n.Cartesian3,Q=new u.Plane(n.Cartesian3.UNIT_X,0);h.fromRectangle=function(a,t,r,i,d){var c,h,l,m,x,p,f;if(t=s.defaultValue(t,0),r=s.defaultValue(r,0),i=s.defaultValue(i,e.Ellipsoid.WGS84),a.width<=C.CesiumMath.PI){var M=e.Rectangle.center(a,A),g=i.cartographicToCartesian(M,N),w=new o.EllipsoidTangentPlane(g,i);f=w.plane;var b=M.longitude,y=a.south<0&&a.north>0?0:M.latitude,v=n.Cartographic.fromRadians(b,a.north,r,T),P=n.Cartographic.fromRadians(a.west,a.north,r,R),O=n.Cartographic.fromRadians(a.west,y,r,I),$=n.Cartographic.fromRadians(a.west,a.south,r,E),aa=n.Cartographic.fromRadians(b,a.south,r,B),ta=i.cartographicToCartesian(v,L),ea=i.cartographicToCartesian(P,k),na=i.cartographicToCartesian(O,V),ra=i.cartographicToCartesian($,S),ia=i.cartographicToCartesian(aa,U),sa=w.projectPointToNearestOnPlane(ta,_),oa=w.projectPointToNearestOnPlane(ea,D),Ca=w.projectPointToNearestOnPlane(na,X),ua=w.projectPointToNearestOnPlane(ra,W),da=w.projectPointToNearestOnPlane(ia,q);return h=-(c=Math.min(oa.x,Ca.x,ua.x)),m=Math.max(oa.y,sa.y),l=Math.min(ua.y,da.y),P.height=$.height=t,ea=i.cartographicToCartesian(P,k),ra=i.cartographicToCartesian($,S),x=Math.min(u.Plane.getPointDistance(f,ea),u.Plane.getPointDistance(f,ra)),p=r,z(w.origin,w.xAxis,w.yAxis,w.zAxis,c,h,l,m,x,p,d)}var ca=a.south>0,ha=a.north<0,la=ca?a.south:ha?a.north:0,ma=e.Rectangle.center(a,A).longitude,xa=n.Cartesian3.fromRadians(ma,la,r,i,j);xa.z=0;var pa=Math.abs(xa.x)<C.CesiumMath.EPSILON10&&Math.abs(xa.y)<C.CesiumMath.EPSILON10?n.Cartesian3.UNIT_X:n.Cartesian3.normalize(xa,Z),fa=n.Cartesian3.UNIT_Z,Ma=n.Cartesian3.cross(pa,fa,F);f=u.Plane.fromPointNormal(xa,pa,Q);var ga=n.Cartesian3.fromRadians(ma+C.CesiumMath.PI_OVER_TWO,la,r,i,G);c=-(h=n.Cartesian3.dot(u.Plane.projectPointOntoPlane(f,ga,Y),Ma)),m=n.Cartesian3.fromRadians(0,a.north,ha?t:r,i,H).z,l=n.Cartesian3.fromRadians(0,a.south,ca?t:r,i,J).z;var wa=n.Cartesian3.fromRadians(a.east,la,r,i,K);return z(xa,Ma,fa,pa,c,h,l,m,x=u.Plane.getPointDistance(f,wa),p=0,d)},h.clone=function(a,e){if(s.defined(a))return s.defined(e)?(n.Cartesian3.clone(a.center,e.center),t.Matrix3.clone(a.halfAxes,e.halfAxes),e.areaDirty=1,e):new h(a.center,a.halfAxes)},h.intersectPlane=function(a,e){var r=a.center,i=e.normal,s=a.halfAxes,o=i.x,C=i.y,u=i.z,d=Math.abs(o*s[t.Matrix3.COLUMN0ROW0]+C*s[t.Matrix3.COLUMN0ROW1]+u*s[t.Matrix3.COLUMN0ROW2])+Math.abs(o*s[t.Matrix3.COLUMN1ROW0]+C*s[t.Matrix3.COLUMN1ROW1]+u*s[t.Matrix3.COLUMN1ROW2])+Math.abs(o*s[t.Matrix3.COLUMN2ROW0]+C*s[t.Matrix3.COLUMN2ROW1]+u*s[t.Matrix3.COLUMN2ROW2]),c=n.Cartesian3.dot(i,r)+e.distance;return c<=-d?t.Intersect.OUTSIDE:c>=d?t.Intersect.INSIDE:t.Intersect.INTERSECTING};var $=new n.Cartesian3,aa=new n.Cartesian3,ta=new n.Cartesian3,ea=new n.Cartesian3,na=new n.Cartesian3;h.distanceSquaredTo=function(a,e){var r=n.Cartesian3.subtract(e,a.center,P),i=a.halfAxes,s=t.Matrix3.getColumn(i,0,$),o=t.Matrix3.getColumn(i,1,aa),C=t.Matrix3.getColumn(i,2,ta),u=n.Cartesian3.magnitude(s),d=n.Cartesian3.magnitude(o),c=n.Cartesian3.magnitude(C);n.Cartesian3.normalize(s,s),n.Cartesian3.normalize(o,o),n.Cartesian3.normalize(C,C);var h=ea;h.x=n.Cartesian3.dot(r,s),h.y=n.Cartesian3.dot(r,o),h.z=n.Cartesian3.dot(r,C);var l,m=0;return h.x<-u?m+=(l=h.x+u)*l:h.x>u&&(m+=(l=h.x-u)*l),h.y<-d?m+=(l=h.y+d)*l:h.y>d&&(m+=(l=h.y-d)*l),h.z<-c?m+=(l=h.z+c)*l:h.z>c&&(m+=(l=h.z-c)*l),m};var ra=new n.Cartesian3,ia=new n.Cartesian3;h.computePlaneDistances=function(a,e,r,i){s.defined(i)||(i=new t.Interval);var o=Number.POSITIVE_INFINITY,C=Number.NEGATIVE_INFINITY,u=a.center,d=a.halfAxes,c=t.Matrix3.getColumn(d,0,$),h=t.Matrix3.getColumn(d,1,aa),l=t.Matrix3.getColumn(d,2,ta),m=n.Cartesian3.add(c,h,ra);n.Cartesian3.add(m,l,m),n.Cartesian3.add(m,u,m);var x=n.Cartesian3.subtract(m,e,ia),p=n.Cartesian3.dot(r,x);return o=Math.min(p,o),C=Math.max(p,C),n.Cartesian3.add(u,c,m),n.Cartesian3.add(m,h,m),n.Cartesian3.subtract(m,l,m),n.Cartesian3.subtract(m,e,x),p=n.Cartesian3.dot(r,x),o=Math.min(p,o),C=Math.max(p,C),n.Cartesian3.add(u,c,m),n.Cartesian3.subtract(m,h,m),n.Cartesian3.add(m,l,m),n.Cartesian3.subtract(m,e,x),p=n.Cartesian3.dot(r,x),o=Math.min(p,o),C=Math.max(p,C),n.Cartesian3.add(u,c,m),n.Cartesian3.subtract(m,h,m),n.Cartesian3.subtract(m,l,m),n.Cartesian3.subtract(m,e,x),p=n.Cartesian3.dot(r,x),o=Math.min(p,o),C=Math.max(p,C),n.Cartesian3.subtract(u,c,m),n.Cartesian3.add(m,h,m),n.Cartesian3.add(m,l,m),n.Cartesian3.subtract(m,e,x),p=n.Cartesian3.dot(r,x),o=Math.min(p,o),C=Math.max(p,C),n.Cartesian3.subtract(u,c,m),n.Cartesian3.add(m,h,m),n.Cartesian3.subtract(m,l,m),n.Cartesian3.subtract(m,e,x),p=n.Cartesian3.dot(r,x),o=Math.min(p,o),C=Math.max(p,C),n.Cartesian3.subtract(u,c,m),n.Cartesian3.subtract(m,h,m),n.Cartesian3.add(m,l,m),n.Cartesian3.subtract(m,e,x),p=n.Cartesian3.dot(r,x),o=Math.min(p,o),C=Math.max(p,C),n.Cartesian3.subtract(u,c,m),n.Cartesian3.subtract(m,h,m),n.Cartesian3.subtract(m,l,m),n.Cartesian3.subtract(m,e,x),p=n.Cartesian3.dot(r,x),o=Math.min(p,o),C=Math.max(p,C),i.start=o,i.stop=C,i};var sa=new t.BoundingSphere;h.isOccluded=function(a,e){var n=t.BoundingSphere.fromOrientedBoundingBox(a,sa);return!e.isBoundingSphereVisible(n)},h.prototype.intersectPlane=function(a){return h.intersectPlane(this,a)},h.prototype.distanceSquaredTo=function(a){return h.distanceSquaredTo(this,a)},h.prototype.computePlaneDistances=function(a,t,e){return h.computePlaneDistances(this,a,t,e)},h.prototype.isOccluded=function(a){return h.isOccluded(this,a)},h.equals=function(a,e){return a===e||s.defined(a)&&s.defined(e)&&n.Cartesian3.equals(a.center,e.center)&&t.Matrix3.equals(a.halfAxes,e.halfAxes)},h.prototype.clone=function(a){return h.clone(this,a)},h.prototype.equals=function(a){return h.equals(this,a)};var oa=new r.Cartesian4;h.prototype._updateBBox=function(){if(1==this.areaDirty){var a=t.Matrix3.getColumn(this.halfAxes,0,$),e=n.Cartesian3.clone(n.Cartesian3.negate(a,b)),r=t.Matrix3.getColumn(this.halfAxes,1,aa),i=n.Cartesian3.clone(n.Cartesian3.negate(r,b)),s=t.Matrix3.getColumn(this.halfAxes,2,ta),o=n.Cartesian3.clone(n.Cartesian3.negate(s,b));this.bbox=[],n.Cartesian3.add(this.center,r,b),n.Cartesian3.add(b,o,y),n.Cartesian3.add(y,e,v),this.bbox[0]=new n.Cartesian3(v.x,v.y,v.z),n.Cartesian3.add(y,a,v),this.bbox[1]=new n.Cartesian3(v.x,v.y,v.z),n.Cartesian3.add(b,s,y),n.Cartesian3.add(y,a,v),this.bbox[2]=new n.Cartesian3(v.x,v.y,v.z),n.Cartesian3.add(y,e,v),this.bbox[3]=new n.Cartesian3(v.x,v.y,v.z),n.Cartesian3.add(this.center,i,b),n.Cartesian3.add(b,o,y),n.Cartesian3.add(y,e,v),this.bbox[4]=new n.Cartesian3(v.x,v.y,v.z),n.Cartesian3.add(y,a,v),this.bbox[5]=new n.Cartesian3(v.x,v.y,v.z),n.Cartesian3.add(b,s,y),n.Cartesian3.add(y,a,v),this.bbox[6]=new n.Cartesian3(v.x,v.y,v.z),n.Cartesian3.add(y,e,v),this.bbox[7]=new n.Cartesian3(v.x,v.y,v.z);var C=n.Cartesian3.magnitude(a),u=n.Cartesian3.magnitude(r),d=n.Cartesian3.magnitude(s),c=new n.Cartesian3(-C,-u,-d),h=new n.Cartesian3(C,u,d);if(C*u*d==0)return void(this.areaDirty=-1);n.Cartesian3.normalize(a,a),n.Cartesian3.normalize(r,r),n.Cartesian3.normalize(s,s),this.u=n.Cartesian3.clone(a),this.v=n.Cartesian3.clone(r),this.w=n.Cartesian3.clone(s),this.posMin=c,this.posMaX=h,this.areaDirty=0}};var Ca=[];Ca.push(new e.Cartesian2),Ca.push(new e.Cartesian2),Ca.push(new e.Cartesian2),Ca.push(new e.Cartesian2),Ca.push(new e.Cartesian2),Ca.push(new e.Cartesian2);var ua=new n.Cartographic,da=new n.Cartesian3;h.prototype.calculateBoxArea=function(a,e,i,o,u,h,l,m){this._updateBBox();var x=a,p=n.Cartesian3.subtract(x,this.center,na);if(-1==this.areaDirty){var f=u/o*(N=-1!=h?h:.5*n.Cartesian3.distance(this.posMaX,this.posMin))/i;return C.CesiumMath.PI*f*f}var M=n.Cartesian3.fromElements(n.Cartesian3.dot(p,this.u),n.Cartesian3.dot(p,this.v),n.Cartesian3.dot(p,this.w),ra),g=(M.x<this.posMin.x?1:0)+((M.x>this.posMaX.x?1:0)<<1)+((M.z<this.posMin.z?1:0)<<2)+((M.z>this.posMaX.z?1:0)<<3)+((M.y>this.posMaX.y?1:0)<<4)+((M.y<this.posMin.y?1:0)<<5);if(g>42)return console.log("area calculation is wrong"),-100;var w=c[g];if(0==w.num){f=u/o*(N=-1!=h?h:.5*n.Cartesian3.distance(this.posMaX,this.posMin))/i;return C.CesiumMath.PI*f*f}if(0==w.num)return console.log("area calculation is wrong"),-100;for(var b,y=[],v=l,P=0;P<w.num;P++){var O,z=Ca[P],A=this.bbox[w.data[P]];b=!1;var N,T=C.CesiumMath.PI;if(3===e)(O=t.Matrix4.multiplyByVector(v,r.Cartesian4.fromElements(A.x,A.y,A.z,1),oa)).z<0&&(b=!0,-1==N&&(T=C.CesiumMath.PI_OVER_FOUR,i=n.Cartesian3.magnitude(p)));else{var R=m,I=R.ellipsoid.cartesianToCartographic(A,ua);s.defined(I)?(R.project(I,da),(O=t.Matrix4.multiplyByVector(v,r.Cartesian4.fromElements(da.z,da.x,da.y,1),oa)).z<0&&(b=!0)):b=!0}if(1==b)return T*(f=u/o*(N=-1!=h?h:.5*n.Cartesian3.distance(this.posMaX,this.posMin))/i)*f;z.x=O.x/O.w,z.y=u-O.y/O.w,y.push(z)}return Math.abs(d.PolygonPipeline.computeArea2D(y))},a.OrientedBoundingBox=h}));
