define(["./EllipsoidTangentPlane-806cff3c","./PrimitiveType-108f83af","./Cartesian2-47311507","./Cartographic-3309dd0d","./when-b60132fc","./TerrainEncoding-48d8e248","./Math-119be1a3","./OrientedBoundingBox-bfa2f286","./RuntimeError-4a5c8994","./GeometryAttribute-b20c1286","./WebMercatorProjection-01b1b5e7","./createTaskProcessorWorker","./Check-7b2a090c","./Cartesian4-3ca25aab","./IntersectionTests-6eb562ca","./Plane-e2d409ef","./WebGLConstants-4ae0db90","./AttributeCompression-90851096","./ComponentDatatype-c140a87d","./PolygonPipeline-03d66105","./earcut-2.2.1-20c8012f","./EllipsoidRhumbLine-ed1a6bf4","./FeatureDetection-c3b71206","./buildModuleUrl-3addfe33"],(function(e,t,i,a,r,n,o,s,u,h,c,d,l,g,m,p,v,I,f,E,C,T,M,b){"use strict";var N=Uint16Array.BYTES_PER_ELEMENT,x=Int32Array.BYTES_PER_ELEMENT,S=Uint32Array.BYTES_PER_ELEMENT,P=Float32Array.BYTES_PER_ELEMENT,w=Float64Array.BYTES_PER_ELEMENT;function y(e,t,i){i=r.defaultValue(i,o.CesiumMath);for(var a=e.length,n=0;n<a;++n)if(i.equalsEpsilon(e[n],t,o.CesiumMath.EPSILON12))return n;return-1}var B=new a.Cartographic,A=new a.Cartesian3,R=new a.Cartesian3,_=new a.Cartesian3,F=new t.Matrix4;function W(e,n,s,u,h,c,d,l,g,m){for(var p=d.length,v=0;v<p;++v){var I=d[v],f=I.cartographic,E=I.index,C=e.length,T=f.longitude,M=f.latitude;M=o.CesiumMath.clamp(M,-o.CesiumMath.PI_OVER_TWO,o.CesiumMath.PI_OVER_TWO);var b=f.height-c.skirtHeight;c.hMin=Math.min(c.hMin,b),a.Cartographic.fromRadians(T,M,b,B),g&&(B.longitude+=l),g?v===p-1?B.latitude+=m:0===v&&(B.latitude-=m):B.latitude+=l;var N=c.ellipsoid.cartographicToCartesian(B);e.push(N),n.push(b),s.push(i.Cartesian2.clone(s[E])),u.length>0&&u.push(u[E]),t.Matrix4.multiplyByPoint(c.toENU,N,A);var x=c.minimum,S=c.maximum;a.Cartesian3.minimumByComponent(A,x,x),a.Cartesian3.maximumByComponent(A,S,S);var P=c.lastBorderPoint;if(r.defined(P)){var w=P.index;h.push(w,C-1,C,C,E,w)}c.lastBorderPoint=I}}return d((function(d,l){d.ellipsoid=i.Ellipsoid.clone(d.ellipsoid),d.rectangle=i.Rectangle.clone(d.rectangle);var g=function(d,l,g,m,p,v,I,f,E,C){var T,M,b,O,U,Y;r.defined(m)?(T=m.west,M=m.south,b=m.east,O=m.north,U=m.width,Y=m.height):(T=o.CesiumMath.toRadians(p.west),M=o.CesiumMath.toRadians(p.south),b=o.CesiumMath.toRadians(p.east),O=o.CesiumMath.toRadians(p.north),U=o.CesiumMath.toRadians(m.width),Y=o.CesiumMath.toRadians(m.height));var k,V,L=[M,O],H=[T,b],D=h.Transforms.eastNorthUpToFixedFrame(l,g),G=t.Matrix4.inverseTransformation(D,F);f&&(k=c.WebMercatorProjection.geodeticLatitudeToMercatorAngle(M),V=1/(c.WebMercatorProjection.geodeticLatitudeToMercatorAngle(O)-k));var j=new DataView(d),z=Number.POSITIVE_INFINITY,q=Number.NEGATIVE_INFINITY,J=R;J.x=Number.POSITIVE_INFINITY,J.y=Number.POSITIVE_INFINITY,J.z=Number.POSITIVE_INFINITY;var K=_;K.x=Number.NEGATIVE_INFINITY,K.y=Number.NEGATIVE_INFINITY,K.z=Number.NEGATIVE_INFINITY;var Q,X,Z=0,$=0,ee=0;for(X=0;X<4;++X){var te=Z;Q=j.getUint32(te,!0),te+=S;var ie=o.CesiumMath.toRadians(180*j.getFloat64(te,!0));te+=w,-1===y(H,ie)&&H.push(ie);var ae=o.CesiumMath.toRadians(180*j.getFloat64(te,!0));te+=w,-1===y(L,ae)&&L.push(ae),te+=2*w;var re=j.getInt32(te,!0);te+=x,$+=re,ee+=3*(re=j.getInt32(te,!0)),Z+=Q+S}var ne=[],oe=[],se=new Array($),ue=new Array($),he=new Array($),ce=f?new Array($):[],de=new Array(ee),le=[],ge=[],me=[],pe=[],ve=0,Ie=0;for(Z=0,X=0;X<4;++X){Q=j.getUint32(Z,!0);var fe=Z+=S,Ee=o.CesiumMath.toRadians(180*j.getFloat64(Z,!0));Z+=w;var Ce=o.CesiumMath.toRadians(180*j.getFloat64(Z,!0));Z+=w;var Te=o.CesiumMath.toRadians(180*j.getFloat64(Z,!0)),Me=.5*Te;Z+=w;var be=o.CesiumMath.toRadians(180*j.getFloat64(Z,!0)),Ne=.5*be;Z+=w;var xe=j.getInt32(Z,!0);Z+=x;var Se=j.getInt32(Z,!0);Z+=x,Z+=x;for(var Pe=new Array(xe),we=0;we<xe;++we){var ye=Ee+j.getUint8(Z++)*Te;B.longitude=ye;var Be=Ce+j.getUint8(Z++)*be;B.latitude=Be;var Ae=j.getFloat32(Z,!0);if(Z+=P,0!==Ae&&Ae<C&&(Ae*=-Math.pow(2,E)),Ae*=6371010*v,B.height=Ae,-1!==y(H,ye)||-1!==y(L,Be)){var Re=y(ne,B,a.Cartographic);if(-1!==Re){Pe[we]=oe[Re];continue}ne.push(a.Cartographic.clone(B)),oe.push(ve)}Pe[we]=ve,Math.abs(ye-T)<Me?le.push({index:ve,cartographic:a.Cartographic.clone(B)}):Math.abs(ye-b)<Me?me.push({index:ve,cartographic:a.Cartographic.clone(B)}):Math.abs(Be-M)<Ne?ge.push({index:ve,cartographic:a.Cartographic.clone(B)}):Math.abs(Be-O)<Ne&&pe.push({index:ve,cartographic:a.Cartographic.clone(B)}),z=Math.min(Ae,z),q=Math.max(Ae,q),he[ve]=Ae;var _e=g.cartographicToCartesian(B);se[ve]=_e,f&&(ce[ve]=(c.WebMercatorProjection.geodeticLatitudeToMercatorAngle(Be)-k)*V),t.Matrix4.multiplyByPoint(G,_e,A),a.Cartesian3.minimumByComponent(A,J,J),a.Cartesian3.maximumByComponent(A,K,K);var Fe=(ye-T)/(b-T);Fe=o.CesiumMath.clamp(Fe,0,1);var We=(Be-M)/(O-M);We=o.CesiumMath.clamp(We,0,1),ue[ve]=new i.Cartesian2(Fe,We),++ve}for(var Oe=3*Se,Ue=0;Ue<Oe;++Ue,++Ie)de[Ie]=Pe[j.getUint16(Z,!0)],Z+=N;if(Q!==Z-fe)throw new u.RuntimeError("Invalid terrain tile.")}se.length=ve,ue.length=ve,he.length=ve,f&&(ce.length=ve);var Ye=ve,ke=Ie,Ve={hMin:z,lastBorderPoint:void 0,skirtHeight:I,toENU:G,ellipsoid:g,minimum:J,maximum:K};le.sort((function(e,t){return t.cartographic.latitude-e.cartographic.latitude})),ge.sort((function(e,t){return e.cartographic.longitude-t.cartographic.longitude})),me.sort((function(e,t){return e.cartographic.latitude-t.cartographic.latitude})),pe.sort((function(e,t){return t.cartographic.longitude-e.cartographic.longitude}));var Le=1e-5;if(W(se,he,ue,ce,de,Ve,le,-Le*U,!0,-Le*Y),W(se,he,ue,ce,de,Ve,ge,-Le*Y,!1),W(se,he,ue,ce,de,Ve,me,Le*U,!0,Le*Y),W(se,he,ue,ce,de,Ve,pe,Le*Y,!1),le.length>0&&pe.length>0){var He=le[0].index,De=Ye,Ge=pe[pe.length-1].index,je=se.length-1;de.push(Ge,je,De,De,He,Ge)}$=se.length;var ze,qe=t.BoundingSphere.fromPoints(se);r.defined(m)&&(ze=s.OrientedBoundingBox.fromRectangle(m,z,q,g));for(var Je=new n.EllipsoidalOccluder(g).computeHorizonCullingPointPossiblyUnderEllipsoid(l,se,z),Ke=new e.AxisAlignedBoundingBox(J,K,l),Qe=new n.TerrainEncoding(Ke,Ve.hMin,q,D,!1,f),Xe=new Float32Array($*Qe.getStride()),Ze=0,$e=0;$e<$;++$e)Ze=Qe.encode(Xe,Ze,se[$e],ue[$e],he[$e],void 0,ce[$e]);var et=le.map((function(e){return e.index})).reverse(),tt=ge.map((function(e){return e.index})).reverse(),it=me.map((function(e){return e.index})).reverse(),at=pe.map((function(e){return e.index})).reverse();return tt.unshift(it[it.length-1]),tt.push(et[0]),at.unshift(et[et.length-1]),at.push(it[0]),{vertices:Xe,indices:new Uint16Array(de),maximumHeight:q,minimumHeight:z,encoding:Qe,boundingSphere3D:qe,orientedBoundingBox:ze,occludeePointInScaledSpace:Je,vertexCountWithoutSkirts:Ye,indexCountWithoutSkirts:ke,westIndicesSouthToNorth:et,southIndicesEastToWest:tt,eastIndicesNorthToSouth:it,northIndicesWestToEast:at}}(d.buffer,d.relativeToCenter,d.ellipsoid,d.rectangle,d.nativeRectangle,d.exaggeration,d.skirtHeight,d.includeWebMercatorT,d.negativeAltitudeExponentBias,d.negativeElevationThreshold),m=g.vertices;l.push(m.buffer);var p=g.indices;return l.push(p.buffer),{vertices:m.buffer,indices:p.buffer,numberOfAttributes:g.encoding.getStride(),minimumHeight:g.minimumHeight,maximumHeight:g.maximumHeight,boundingSphere3D:g.boundingSphere3D,orientedBoundingBox:g.orientedBoundingBox,occludeePointInScaledSpace:g.occludeePointInScaledSpace,encoding:g.encoding,vertexCountWithoutSkirts:g.vertexCountWithoutSkirts,indexCountWithoutSkirts:g.indexCountWithoutSkirts,westIndicesSouthToNorth:g.westIndicesSouthToNorth,southIndicesEastToWest:g.southIndicesEastToWest,eastIndicesNorthToSouth:g.eastIndicesNorthToSouth,northIndicesWestToEast:g.northIndicesWestToEast}}))}));
