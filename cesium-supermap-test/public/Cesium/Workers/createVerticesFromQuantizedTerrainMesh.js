define(["./AttributeCompression-90851096","./EllipsoidTangentPlane-806cff3c","./PrimitiveType-108f83af","./Cartesian2-47311507","./Cartographic-3309dd0d","./when-b60132fc","./TerrainEncoding-48d8e248","./IndexDatatype-8a5eead4","./Math-119be1a3","./OrientedBoundingBox-bfa2f286","./Check-7b2a090c","./GeometryAttribute-b20c1286","./WebMercatorProjection-01b1b5e7","./createTaskProcessorWorker","./Cartesian4-3ca25aab","./IntersectionTests-6eb562ca","./Plane-e2d409ef","./RuntimeError-4a5c8994","./WebGLConstants-4ae0db90","./ComponentDatatype-c140a87d","./PolygonPipeline-03d66105","./earcut-2.2.1-20c8012f","./EllipsoidRhumbLine-ed1a6bf4","./FeatureDetection-c3b71206","./buildModuleUrl-3addfe33"],(function(e,t,r,i,n,o,a,s,d,c,u,h,l,I,m,g,f,T,v,p,E,y,w,N,x){"use strict";function M(){u.DeveloperError.throwInstantiationError()}Object.defineProperties(M.prototype,{errorEvent:{get:u.DeveloperError.throwInstantiationError},credit:{get:u.DeveloperError.throwInstantiationError},tilingScheme:{get:u.DeveloperError.throwInstantiationError},ready:{get:u.DeveloperError.throwInstantiationError},readyPromise:{get:u.DeveloperError.throwInstantiationError},hasWaterMask:{get:u.DeveloperError.throwInstantiationError},hasVertexNormals:{get:u.DeveloperError.throwInstantiationError},availability:{get:u.DeveloperError.throwInstantiationError}});var b=[];M.getRegularGridIndices=function(e,t){var r=b[e];o.defined(r)||(b[e]=r=[]);var i=r[t];return o.defined(i)||P(e,t,i=e*t<d.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6+3*(e+t-2)):r[t]=new Uint32Array((e-1)*(t-1)*6+3*(e+t-2)),0),i},M.getRegularGridIndicesForReproject=function(e,t){var r=b[e];o.defined(r)||(b[e]=r=[]);var i=r[t];return o.defined(i)||P(e,t,i=e*t<d.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),0),i};var C=[];M.getRegularGridIndicesAndEdgeIndices=function(e,t){var r=C[e];o.defined(r)||(C[e]=r=[]);var i=r[t];if(!o.defined(i)){var n=M.getRegularGridIndices(e,t),a=S(e,t),s=a.westIndicesSouthToNorth,d=a.southIndicesEastToWest,c=a.eastIndicesNorthToSouth,u=a.northIndicesWestToEast;i=r[t]={indices:n,westIndicesSouthToNorth:s,southIndicesEastToWest:d,eastIndicesNorthToSouth:c,northIndicesWestToEast:u}}return i};var A=[];function S(e,t){var r,i=new Array(t),n=new Array(e),o=new Array(t),a=new Array(e);for(r=0;r<e;++r)a[r]=r,n[r]=e*t-1-r;for(r=0;r<t;++r)o[r]=(r+1)*e-1,i[r]=(t-r-1)*e;return{westIndicesSouthToNorth:i,southIndicesEastToWest:n,eastIndicesNorthToSouth:o,northIndicesWestToEast:a}}function P(e,t,r,i){for(var n=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=n,d=s+e,c=d+1,u=s+1;r[i++]=s,r[i++]=d,r[i++]=u,r[i++]=u,r[i++]=d,r[i++]=c,++n}++n}var h=(t-1)/2,l=(e-1)/2;n=0;for(a=0;a<l;a++)r[i++]=n,r[i++]=n+1,r[i++]=n+2,n+=2;n=e*(t-1);for(a=0;a<l;a++)r[i++]=n+1,r[i++]=n,r[i++]=n+2,n+=2;n=0;for(a=0;a<h;a++)r[i++]=n+e,r[i++]=n,r[i++]=n+2*e,n+=2*e;n=e-1;for(a=0;a<h;a++)r[i++]=n,r[i++]=n+e,r[i++]=n+2*e,n+=2*e}function W(e,t,r,i,n){for(var a=o.defined(n),s=e[0],d=e.length,c=1;c<d;++c){var u=e[c];!a||n[s+"_"+u]?(r[i++]=s,r[i++]=u,r[i++]=t,r[i++]=t,r[i++]=u,r[i++]=t+1,s=u,++t):(s=u,++t)}return i}M.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){var r=A[e];o.defined(r)||(A[e]=r=[]);var i=r[t];if(!o.defined(i)){var n=e*t,a=(e-1)*(t-1)*6,d=2*e+2*t,c=n+d,u=3*(e+t-2),h=a+6*Math.max(0,d-4)+u,l=S(e,t),I=l.westIndicesSouthToNorth,m=l.southIndicesEastToWest,g=l.eastIndicesNorthToSouth,f=l.northIndicesWestToEast,T=s.IndexDatatype.createTypedArray(c,h);P(e,t,T,0),M.addSkirtIndices(I,m,g,f,n,T,a+u),i=r[t]={indices:T,westIndicesSouthToNorth:I,southIndicesEastToWest:m,eastIndicesNorthToSouth:g,northIndicesWestToEast:f,indexCountWithoutSkirts:a}}return i},M.addSkirtIndices=function(e,t,r,i,n,o,a,s){var d=n;a=W(e,d,o,a,s),a=W(t,d+=e.length,o,a,s),a=W(r,d+=t.length,o,a,s),W(i,d+=r.length,o,a,s)},M.heightmapTerrainQuality=.25,M.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*M.heightmapTerrainQuality/(t*r)},M.prototype.requestTileGeometry=u.DeveloperError.throwInstantiationError,M.prototype.getLevelMaximumGeometricError=u.DeveloperError.throwInstantiationError,M.prototype.getTileDataAvailable=u.DeveloperError.throwInstantiationError,M.prototype.loadTileDataAvailability=u.DeveloperError.throwInstantiationError;var B=32767,_=new n.Cartesian3,F=new n.Cartesian3,D=new n.Cartesian3,k=new n.Cartographic,H=new i.Cartesian2,O=new n.Cartesian3,V=new r.Matrix4,G=new r.Matrix4;function Y(e,t,i,o,a,s,c,u,h){var l=Number.POSITIVE_INFINITY,I=a.north,m=a.south,g=a.east,f=a.west;g<f&&(g+=d.CesiumMath.TWO_PI);for(var T=e.length,v=0;v<T;++v){var p=e[v],E=i[p],y=o[p];k.longitude=d.CesiumMath.lerp(f,g,y.x),k.latitude=d.CesiumMath.lerp(m,I,y.y),k.height=E-t;var w=s.cartographicToCartesian(k,_);r.Matrix4.multiplyByPoint(c,w,w),n.Cartesian3.minimumByComponent(w,u,u),n.Cartesian3.maximumByComponent(w,h,h),l=Math.min(l,k.height)}return l}function R(t,i,a,s,c,u,I,m,g,f,T,v,p,E,y){var w=o.defined(I),N=g.north,x=g.south,M=g.east,b=g.west;M<b&&(M+=d.CesiumMath.TWO_PI);for(var C=a.length,A=0;A<C;++A){var S=a[A],P=c[S],W=u[S];k.longitude=d.CesiumMath.lerp(b,M,W.x)+E,k.latitude=d.CesiumMath.lerp(x,N,W.y)+y,k.height=P-f;var B,F=m.cartographicToCartesian(k,_);if(w){var D=2*S;if(H.x=I[D],H.y=I[D+1],1!==T){var Y=e.AttributeCompression.octDecode(H.x,H.y,O),R=h.Transforms.eastNorthUpToFixedFrame(_,m,G),U=r.Matrix4.inverseTransformation(R,V);r.Matrix4.multiplyByPointAsVector(U,Y,Y),Y.z*=T,n.Cartesian3.normalize(Y,Y),r.Matrix4.multiplyByPointAsVector(R,Y,Y),n.Cartesian3.normalize(Y,Y),e.AttributeCompression.octEncode(Y,H)}}s.hasWebMercatorT&&(B=(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(k.latitude)-v)*p),i=s.encode(t,i,F,W,k.height,H,B)}}function U(e,t){var r;return"function"==typeof e.slice&&"function"!=typeof(r=e.slice()).sort&&(r=void 0),o.defined(r)||(r=Array.prototype.slice.call(e)),r.sort(t),r}return I((function(u,I){var m,g,f=u.quantizedVertices,T=f.length/3,v=u.octEncodedNormals,p=u.westIndices.length+u.eastIndices.length+u.southIndices.length+u.northIndices.length,E=u.includeWebMercatorT,y=i.Rectangle.clone(u.rectangle),w=y.west,N=y.south,x=y.east,b=y.north,C=i.Ellipsoid.clone(u.ellipsoid),A=u.exaggeration,S=u.minimumHeight*A,P=u.maximumHeight*A,W=o.defined(u.validMinimumHeight)?u.validMinimumHeight*A:S*A,z=o.defined(u.validMaximumHeight)?u.validMaximumHeight*A:P*A,L=u.relativeToCenter,j=h.Transforms.eastNorthUpToFixedFrame(L,C),q=r.Matrix4.inverseTransformation(j,new r.Matrix4);E&&(m=l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(N),g=1/(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(b)-m));var K=f.subarray(0,T),Q=f.subarray(T,2*T),X=f.subarray(2*T,3*T),Z=o.defined(v),J=new Array(T),$=new Array(T),ee=new Array(T),te=E?new Array(T):[],re=F;re.x=Number.POSITIVE_INFINITY,re.y=Number.POSITIVE_INFINITY,re.z=Number.POSITIVE_INFINITY;var ie=D;ie.x=Number.NEGATIVE_INFINITY,ie.y=Number.NEGATIVE_INFINITY,ie.z=Number.NEGATIVE_INFINITY;for(var ne=Number.POSITIVE_INFINITY,oe=Number.NEGATIVE_INFINITY,ae=Number.POSITIVE_INFINITY,se=Number.NEGATIVE_INFINITY,de=0;de<T;++de){var ce=K[de],ue=Q[de],he=ce/B,le=ue/B,Ie=d.CesiumMath.lerp(S,P,X[de]/B);k.longitude=d.CesiumMath.lerp(w,x,he),k.latitude=d.CesiumMath.lerp(N,b,le),k.height=Ie,ne=Math.min(k.longitude,ne),oe=Math.max(k.longitude,oe),ae=Math.min(k.latitude,ae),se=Math.max(k.latitude,se);var me=C.cartographicToCartesian(k);J[de]=new i.Cartesian2(he,le),$[de]=Ie,ee[de]=me,E&&(te[de]=(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(k.latitude)-m)*g),r.Matrix4.multiplyByPoint(q,me,_),n.Cartesian3.minimumByComponent(_,re,re),n.Cartesian3.maximumByComponent(_,ie,ie)}var ge,fe,Te=U(u.westIndices,(function(e,t){return J[e].y-J[t].y})),ve=U(u.eastIndices,(function(e,t){return J[t].y-J[e].y})),pe=U(u.southIndices,(function(e,t){return J[t].x-J[e].x})),Ee=U(u.northIndices,(function(e,t){return J[e].x-J[t].x}));fe=r.BoundingSphere.fromPoints(ee),ge=c.OrientedBoundingBox.fromRectangle(y,S,P,C);var ye,we=c.OrientedBoundingBox.fromRectangle(y,W,z,C);(1!==A||S<0)&&(ye=new a.EllipsoidalOccluder(C).computeHorizonCullingPointPossiblyUnderEllipsoid(L,ee,S));var Ne=S;Ne=Math.min(Ne,Y(u.westIndices,u.westSkirtHeight,$,J,y,C,q,re,ie)),Ne=Math.min(Ne,Y(u.southIndices,u.southSkirtHeight,$,J,y,C,q,re,ie)),Ne=Math.min(Ne,Y(u.eastIndices,u.eastSkirtHeight,$,J,y,C,q,re,ie)),Ne=Math.min(Ne,Y(u.northIndices,u.northSkirtHeight,$,J,y,C,q,re,ie));for(var xe=new t.AxisAlignedBoundingBox(re,ie,L),Me=new a.TerrainEncoding(xe,Ne,P,j,Z,E),be=Me.getStride(),Ce=new Float32Array(T*be+p*be),Ae=0,Se=0;Se<T;++Se){if(Z){var Pe=2*Se;if(H.x=v[Pe],H.y=v[Pe+1],1!==A){var We=e.AttributeCompression.octDecode(H.x,H.y,O),Be=h.Transforms.eastNorthUpToFixedFrame(ee[Se],C,G),_e=r.Matrix4.inverseTransformation(Be,V);r.Matrix4.multiplyByPointAsVector(_e,We,We),We.z*=A,n.Cartesian3.normalize(We,We),r.Matrix4.multiplyByPointAsVector(Be,We,We),n.Cartesian3.normalize(We,We),e.AttributeCompression.octEncode(We,H)}}Ae=Me.encode(Ce,Ae,ee[Se],J[Se],$[Se],H,te[Se])}var Fe=Math.max(0,2*(p-4)),De=u.indices.length+3*Fe,ke=s.IndexDatatype.createTypedArray(T+p,De);ke.set(u.indices,0);var He=1e-4,Oe=(oe-ne)*He,Ve=(se-ae)*He,Ge=-Oe,Ye=Oe,Re=Ve,Ue=-Ve,ze=T*be;R(Ce,ze,Te,Me,$,J,v,C,y,u.westSkirtHeight,A,m,g,Ge,0),R(Ce,ze+=u.westIndices.length*be,pe,Me,$,J,v,C,y,u.southSkirtHeight,A,m,g,0,Ue),R(Ce,ze+=u.southIndices.length*be,ve,Me,$,J,v,C,y,u.eastSkirtHeight,A,m,g,Ye,0),R(Ce,ze+=u.eastIndices.length*be,Ee,Me,$,J,v,C,y,u.northSkirtHeight,A,m,g,0,Re);var Le=function(e,t,r,i){if(i<12)return;for(var n={},o=e.length,a=0;a<o;a+=3){var s=e[a],d=e[a+1],c=e[a+2];(t[s]===B&&t[d]===B||0===t[s]&&0===t[d]||r[s]===B&&r[d]===B||0===r[s]&&0===r[d])&&(n[s+"_"+d]=1,n[d+"_"+s]=1),(t[d]===B&&t[c]===B||0===t[d]&&0===t[c]||r[d]===B&&r[c]===B||0===r[d]&&0===r[c])&&(n[d+"_"+c]=1,n[c+"_"+d]=1),(t[c]===B&&t[s]===B||0===t[c]&&0===t[s]||r[c]===B&&r[s]===B||0===r[c]&&0===r[s])&&(n[c+"_"+s]=1,n[s+"_"+c]=1)}return n}(u.indices,K,Q,u.level);return M.addSkirtIndices(Te,pe,ve,Ee,T,ke,u.indices.length,Le),I.push(Ce.buffer,ke.buffer),{vertices:Ce.buffer,indices:ke.buffer,westIndicesSouthToNorth:Te,southIndicesEastToWest:pe,eastIndicesNorthToSouth:ve,northIndicesWestToEast:Ee,vertexStride:be,center:L,minimumHeight:S,maximumHeight:P,boundingSphere:fe,orientedBoundingBox:ge,validOrientedBoundingBox:we,occludeePointInScaledSpace:ye,encoding:Me,indexCountWithoutSkirts:u.indices.length}}))}));
